"use strict";
/**
 * Created by user on 2018/4/13/013.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.hasSupport = null;
try {
    let s = require.resolve('deasync');
    if (s) {
        exports.hasSupport = true;
    }
}
catch (e) {
    if (e.code == 'MODULE_NOT_FOUND') {
        exports.hasSupport = false;
    }
    else {
        console.error(e);
    }
}
function initDeAsync() {
    if (!exports.libDeAsync) {
        exports.libDeAsync = require('deasync');
    }
    return exports.libDeAsync;
}
exports.initDeAsync = initDeAsync;
function sleepSync(timeout) {
    let p = new Promise(function (done) {
        setTimeout(done, timeout);
    });
    initDeAsync().await(p);
    p = p.then(function () {
        return timeout;
    });
    return wrapPromiseFakeSync(p, timeout);
}
exports.sleepSync = sleepSync;
function awaitSync(pr) {
    pr = pr instanceof Promise ? pr : Promise.resolve(pr);
    let v = initDeAsync().await(pr);
    return wrapPromiseFakeSync(pr, v);
}
exports.awaitSync = awaitSync;
function wrapPromiseFakeSync(pr, value) {
    let p = pr;
    p.thenSync = function (fn) {
        return fn(value);
    };
    return p;
}
exports.wrapPromiseFakeSync = wrapPromiseFakeSync;
exports.default = sleepSync;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xlZXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzbGVlcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBSVEsUUFBQSxVQUFVLEdBQVksSUFBSSxDQUFDO0FBR3RDLElBQ0E7SUFDQyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBRW5DLElBQUksQ0FBQyxFQUNMO1FBQ0Msa0JBQVUsR0FBRyxJQUFJLENBQUM7S0FDbEI7Q0FDRDtBQUNELE9BQU8sQ0FBQyxFQUNSO0lBQ0MsSUFBSSxDQUFDLENBQUMsSUFBSSxJQUFJLGtCQUFrQixFQUNoQztRQUNDLGtCQUFVLEdBQUcsS0FBSyxDQUFDO0tBQ25CO1NBRUQ7UUFDQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ2pCO0NBQ0Q7QUFFRCxTQUFnQixXQUFXO0lBRTFCLElBQUksQ0FBQyxrQkFBVSxFQUNmO1FBQ0Msa0JBQVUsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7S0FDaEM7SUFFRCxPQUFPLGtCQUFVLENBQUM7QUFDbkIsQ0FBQztBQVJELGtDQVFDO0FBRUQsU0FBZ0IsU0FBUyxDQUFDLE9BQWU7SUFFeEMsSUFBSSxDQUFDLEdBQUcsSUFBSSxPQUFPLENBQUMsVUFBVSxJQUFJO1FBRWpDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDM0IsQ0FBQyxDQUFDLENBQUM7SUFFSCxXQUFXLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFdkIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFFVixPQUFPLE9BQU8sQ0FBQztJQUNoQixDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sbUJBQW1CLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3hDLENBQUM7QUFmRCw4QkFlQztBQUlELFNBQWdCLFNBQVMsQ0FBQyxFQUFFO0lBRTNCLEVBQUUsR0FBRyxFQUFFLFlBQVksT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7SUFFdEQsSUFBSSxDQUFDLEdBQUcsV0FBVyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBRWhDLE9BQU8sbUJBQW1CLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFQRCw4QkFPQztBQU1ELFNBQWdCLG1CQUFtQixDQUFJLEVBQWdCLEVBQUUsS0FBUTtJQUVoRSxJQUFJLENBQUMsR0FBRyxFQUE2QixDQUFDO0lBRXRDLENBQUMsQ0FBQyxRQUFRLEdBQUcsVUFBVSxFQUFFO1FBRXhCLE9BQU8sRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2xCLENBQUMsQ0FBQztJQUVGLE9BQU8sQ0FBQyxDQUFDO0FBQ1YsQ0FBQztBQVZELGtEQVVDO0FBRUQsa0JBQWUsU0FBUyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IHVzZXIgb24gMjAxOC80LzEzLzAxMy5cbiAqL1xuXG5pbXBvcnQgRGVBc3luYyBmcm9tICdkZWFzeW5jJztcblxuZXhwb3J0IGxldCBoYXNTdXBwb3J0OiBib29sZWFuID0gbnVsbDtcbmV4cG9ydCBsZXQgbGliRGVBc3luYzogdHlwZW9mIERlQXN5bmM7XG5cbnRyeVxue1xuXHRsZXQgcyA9IHJlcXVpcmUucmVzb2x2ZSgnZGVhc3luYycpO1xuXG5cdGlmIChzKVxuXHR7XG5cdFx0aGFzU3VwcG9ydCA9IHRydWU7XG5cdH1cbn1cbmNhdGNoIChlKVxue1xuXHRpZiAoZS5jb2RlID09ICdNT0RVTEVfTk9UX0ZPVU5EJylcblx0e1xuXHRcdGhhc1N1cHBvcnQgPSBmYWxzZTtcblx0fVxuXHRlbHNlXG5cdHtcblx0XHRjb25zb2xlLmVycm9yKGUpO1xuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0RGVBc3luYygpOiBEZUFzeW5jLklBcGlcbntcblx0aWYgKCFsaWJEZUFzeW5jKVxuXHR7XG5cdFx0bGliRGVBc3luYyA9IHJlcXVpcmUoJ2RlYXN5bmMnKTtcblx0fVxuXG5cdHJldHVybiBsaWJEZUFzeW5jO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2xlZXBTeW5jKHRpbWVvdXQ6IG51bWJlcilcbntcblx0bGV0IHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAoZG9uZSlcblx0e1xuXHRcdHNldFRpbWVvdXQoZG9uZSwgdGltZW91dCk7XG5cdH0pO1xuXG5cdGluaXREZUFzeW5jKCkuYXdhaXQocCk7XG5cblx0cCA9IHAudGhlbihmdW5jdGlvbiAoKVxuXHR7XG5cdFx0cmV0dXJuIHRpbWVvdXQ7XG5cdH0pO1xuXG5cdHJldHVybiB3cmFwUHJvbWlzZUZha2VTeW5jKHAsIHRpbWVvdXQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXdhaXRTeW5jPFQ+KHByOiBQcm9taXNlPFQ+KTogSVdyYXBQcm9taXNlRmFrZVN5bmM8VD5cbmV4cG9ydCBmdW5jdGlvbiBhd2FpdFN5bmM8VD4ocHI6IFQpOiBJV3JhcFByb21pc2VGYWtlU3luYzxUPlxuZXhwb3J0IGZ1bmN0aW9uIGF3YWl0U3luYyhwcilcbntcblx0cHIgPSBwciBpbnN0YW5jZW9mIFByb21pc2UgPyBwciA6IFByb21pc2UucmVzb2x2ZShwcik7XG5cblx0bGV0IHYgPSBpbml0RGVBc3luYygpLmF3YWl0KHByKTtcblxuXHRyZXR1cm4gd3JhcFByb21pc2VGYWtlU3luYyhwciwgdik7XG59XG5cbmV4cG9ydCB0eXBlIElXcmFwUHJvbWlzZUZha2VTeW5jPFQ+ID0gUHJvbWlzZTxUPiAmIHtcblx0dGhlblN5bmM8VT4oZm46ICh2YWx1ZTogVCkgPT4gVSk6IFVcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiB3cmFwUHJvbWlzZUZha2VTeW5jPFQ+KHByOiBQcm9taXNlPGFueT4sIHZhbHVlOiBUKVxue1xuXHRsZXQgcCA9IHByIGFzIElXcmFwUHJvbWlzZUZha2VTeW5jPFQ+O1xuXG5cdHAudGhlblN5bmMgPSBmdW5jdGlvbiAoZm4pXG5cdHtcblx0XHRyZXR1cm4gZm4odmFsdWUpO1xuXHR9O1xuXG5cdHJldHVybiBwO1xufVxuXG5leHBvcnQgZGVmYXVsdCBzbGVlcFN5bmNcbiJdfQ==